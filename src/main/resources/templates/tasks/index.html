<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" th:replace="~{base :: layout(~{::title}, ~{::section}, ~{::additionalCss}, ~{::additionalJs})}">
<head>
    <title>Quản lý công việc - Task Management System</title>
    <additionalCss>
        <link rel="stylesheet" th:href="@{/css/tasks/index.css}">
    </additionalCss>
</head>
<body>
    <section class="container-fluid py-5">
        <div class="row">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-list-ul me-2"></i>Danh sách công việc của tôi
                            </h5>
                        </div>
                        
                        <!-- Task list -->
                        <div class="task-list">
                            <div th:each="task : ${tasks}" class="task-item" th:divTask="${task.id}">
                                <div class="task-content">
                                    <!-- Left Column -->
                                    <div class="task-left-col">
                                        <div class="task-header-group">
                                            <h6 class="task-title" th:text="${task.name}">Thiết kế giao diện</h6>
                                            <span th:if="${task.dueDate != null && task.dueDate.isBefore(T(java.time.LocalDate).now())}" 
                                                  class="task-badge task-badge-overdue">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                Quá hạn
                                            </span>
                                        </div>
                                        
                                        <!-- Add Assignees Section -->
                                        <div class="task-assignees-group">
                                            <div class="assignee-avatars">
                                                <div th:each="assignee, iterStat : ${task.assignees}" 
                                                     class="assignee-avatar-wrapper"
                                                     th:if="${iterStat.index < 3}">
                                                    <img th:src="${assignee.avatarUrl}"
                                                         th:alt="${assignee.name}"
                                                         class="assignee-avatar"
                                                         th:title="${assignee.name}">
                                                </div>
                                                <div class="assignee-count" 
                                                     th:if="${task.assignees.size() > 3}"
                                                     th:text="${'+' + (task.assignees.size() - 3)}">
                                                    +2
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Project Link -->
                                        <div class="project-link-group">
                                            <i class="fas fa-project-diagram text-primary"></i>
                                            <a th:href="@{'/projects/' + ${task.projectId}}" 
                                               class="project-link" 
                                               th:text="${task.projectName}">
                                                Tên dự án
                                            </a>
                                        </div>

                                        <div class="task-date-group">
                                            <div class="date-icon-wrapper">
                                                <i class="fas fa-calendar-days"></i>
                                            </div>
                                            <span class="task-date" 
                                                  th:text="${task.dueDate != null ? #temporals.format(task.dueDate, 'dd/MM/yyyy') : 'Chưa có hạn'}">
                                                31/12/2023
                                            </span>
                                        </div>
                                    </div>

                                    <!-- Middle Column -->
                                    <div class="task-middle-col">
                                        <div class="task-description-wrapper">
                                            <p class="task-description" 
                                               th:text="${task.description ?: 'Chưa có mô tả cho công việc này'}">
                                                Mô tả công việc
                                            </p>
                                            <div class="task-tags">
                                                <span class="task-tag" 
                                                      th:if="${task.tag != null}" 
                                                      th:text="${task.tag}">
                                                    Frontend
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Right Column -->
                                    <div class="task-right-col">
                                        <div class="task-status-group">
                                            <span class="status-label">Trạng thái</span>
                                            <div class="dropdown status-dropdown">
                                                <button class="status-badge dropdown-toggle" 
                                                        type="button"
                                                        data-bs-toggle="dropdown"
                                                        th:data-task-id="${task.id}"
                                                        th:classappend="${
                                                            task.status.name() == 'TODO' ? 'status-todo' :
                                                            task.status.name() == 'IN_PROGRESS' ? 'status-progress' :
                                                            task.status.name() == 'REVIEW' ? 'status-review' :
                                                            task.status.name() == 'DONE' ? 'status-done' : ''
                                                        }">
                                                    <i class="fas fa-circle"></i>
                                                    <span th:text="${
                                                        task.status.name() == 'TODO' ? 'Chưa bắt đầu' :
                                                        task.status.name() == 'IN_PROGRESS' ? 'Đang thực hiện' :
                                                        task.status.name() == 'REVIEW' ? 'Đang xem xét' :
                                                        task.status.name() == 'DONE' ? 'Hoàn thành' : ''
                                                    }">Đang thực hiện</span>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a class="dropdown-item" href="#" data-status="TODO">Chưa bắt đầu</a></li>
                                                    <li><a class="dropdown-item" href="#" data-status="IN_PROGRESS">Đang thực hiện</a></li>
                                                    <li><a class="dropdown-item" href="#" data-status="REVIEW">Đang xem xét</a></li>
                                                    <li><a class="dropdown-item" href="#" data-status="DONE">Hoàn thành</a></li>
                                                </ul>
                                            </div>
                                        </div>
                                        
                                        <div class="task-update-group">
                                            <span class="update-label">Cập nhật</span>
                                            <span class="update-time" 
                                                  th:text="${#temporals.format(task.updatedAt, 'dd/MM/yyyy')}">
                                                26/10/2023
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</body>
<additionalJs>
    <script th:src="@{/js/tasks/index.js}"></script>
</additionalJs>
</html>